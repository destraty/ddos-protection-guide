# Безопасность сети и защита от DDoS-атак: Практическое применение инструментов для обнаружения и блокировки DDoS-атак, а также настройка межсетевого экрана с использованием iptables для фильтрации трафика и защиты от вредоносных атак

![Alt-текст](https://media.licdn.com/dms/image/D4D12AQHm1jnyv7m8JQ/article-cover_image-shrink_720_1280/0/1685207257405?e=2147483647&v=beta&t=qDADzXUadnxTNHjy93bdZl2aoGFEyVmYgz2nom1yuWk "Орк")


**Цели работы:**
Изучение основных принципов и методов защиты от DDoS-атак.
Практическое применение инструментов для обнаружения DDoS-атак.
Настройка межсетевого экрана iptables для фильтрации трафика и защиты от вредоносных атак.

# Шаг 1: Введение в DDoS-атаки
## Теоретическая часть:
DDoS (Distributed Denial of Service) - это тип атаки, при которой множество компьютеров (часто зараженных вирусами) направляют трафик на один сервер, что приводит к его перегрузке и недоступности для нормального использования.
## Основные типы DDoS-атак:

- **Volume Based Attacks:** ICMP floods, UDP floods.

- **Protocol Attacks:** SYN floods, fragmented packet attacks.

- **Application Layer Attacks:** HTTP GET/POST floods.

# Шаг 2: Практическая часть:

Установка инструментов для обнаружения DDoS-атак.
Установка Fail2Ban.
Откройте терминал и обновите список пакетов:
```bash
sudo apt update
```
Установите Fail2Ban:
```bash
sudo apt install fail2ban
```
Настройте Fail2Ban, создав копию конфигурационного файла:
```bash
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
```
Отредактируйте файл ```/etc/fail2ban/jail.local```, настроив параметры под свои нужды.

# Шаг 3: Настройка iptables
Просмотр текущих правил iptables:
```bash
sudo iptables -L
```
Блокировка IP-адреса:
```bash
sudo iptables -A INPUT -s <IP-адрес> -j DROP
```
## Примеры настройки для защиты от различных типов атак:
Защита от SYN flood:
```bash
sudo iptables -A INPUT -p tcp --syn -m limit --limit 1/s --limit-burst 3 -j ACCEPT
```
Защита от ICMP flood:
```bash
sudo iptables -A INPUT -p icmp -m limit --limit 1/s --limit-burst 1 -j ACCEPT
```
Защита от UDP flood:
```bash
sudo iptables -A INPUT -p udp -m limit --limit 10/s --limit-burst 20 -j ACCEPT
```

- iptables: Команда для работы с интерфейсом командной строки iptables, который используется для создания, модификации и удаления правил фильтрации пакетов в ядре Linux.
- -A INPUT: Добавляет (-A) новое правило в цепочку INPUT. Цепочка INPUT обрабатывает входящие пакеты.
- -p tcp: Указывает протокол пакетов, к которым применяется правило, в данном случае TCP.
- --syn: Ограничивает применение правила только для синхронизационных пакетов TCP. Синхронизационные пакеты используются при установлении соединения (SYN).
- -m limit: Использование модуля limit для ограничения скорости обработки пакетов.
- --limit 1/s: Устанавливает лимит на количество пакетов, которые могут быть обработаны за секунду, равный одному пакету.
- --limit-burst 3: Определяет максимальное количество пакетов, которые могут быть принятых за один "бурст" или всплеск, до достижения установленного лимита скорости. В данном случае это три пакета.
- -j ACCEPT: Указывает действие, которое следует предпринять при соответствии условию правила. В данном случае пакеты будут приняты (ACCEPT), то есть разрешены проход через систему без дальнейшей проверки.

Чтобы запретить пакеты в iptables, вы можете использовать команду с опцией ```-j DROP``` или ```-j REJECT```, в зависимости от того, какой тип ответа вы хотите отправить обратно клиенту. Вот примеры обоих подходов:

Использование ```-j DROP```: Эта команда просто удаляет пакеты без отправки никакого уведомления обратно клиенту. Это может быть полезно, если вы не хотите предоставлять информацию о том, был ли запрос успешным или нет.
```bash
sudo iptables -A INPUT -s <ip> -j DROP
```
Использование ```-j REJECT```: Эта команда отклоняет пакеты и отправляет клиенту сообщение об ошибке, указывающее, что соединение было отклонено. Это может быть полезно, если вы хотите информировать клиента о причине отказа в подключении.
```bash
sudo iptables -A INPUT -s <ip> -j REJECT
```


Выбор между ```-j DROP``` и ```-j REJECT``` зависит от ваших потребностей в безопасности и от того, хотите ли вы информировать клиентов о причинах отказа в подключении. Обратите внимание, что использование ```-j DROP``` может быть более безопасным вариантом, поскольку он не раскрывает дополнительную информацию о вашей системе или сетевой инфраструктуре.

# Шаг 4: Тестирование настройки защиты
## На атакующей машине:
Установите флудер при помощи команды:
```bash
git clone https://github.com/destraty/ddos-protection-guide
```
Прыгаем в папку:
```bash
cd ddos-protection-guide
```

Запускаем флудилку на нашу цель:
```bash
python dos.py --ip <ip адрес цели> --port <порт для атаки> --duration <время атаки в секундах>
```
## На атакуемой машине:
Найдем какие ip адреса создают большой трафик при помощи командыЖ
```bash
sudo iftop -i eth0
```
Вверху списка будут находиться атакующие ip адреса, нагрузка которых отображается полоской.
IP адрес может быть не один, на каждый создавать отдельное правило - в корне не правильное решение. Это черевато повышением нагрузки на сеть из-за большого списка iptables.
Поэтому будем использовать группы:
Установим ipset
```bash
sudo apt install ipset
```
Создадим новый набор ip адресов:
```bash
sudo ipset create my_black_list hash:ip
```
Добавим в него ip адреса атакующих устройств:
```bash
sudo ipset add my_black_list 192.168.1.2
sudo ipset add my_black_list 192.168.1.3
# Добавьте больше IP-адресов по необходимости
```

Блокируем трафик для данного набора ip адресов:
```bash
sudo iptables -I INPUT -m set --match-set blacklist src -j DROP
```
## Команды для проверки работоспособности защитных механизмов

Просмотр текущих правил iptables:
```
sudo iptables -L
```

Просмотр логов Fail2Ban для проверки блокировок:
```
sudo tail -f /var/log/fail2ban.log
```

Проверка активных соединений и их состояний:
```
sudo netstat -tunapl
```
Мониторинг использования сетевых ресурсов:
```
sudo iftop
``` 
или 
```
sudo nethogs
```
# Заключение
В ходе данной лабораторной работы вы изучите основные принципы защиты от DDoS-атак, научитесь использовать инструменты для их обнаружения и настройки межсетевого экрана для фильтрации трафика. Эти знания и навыки помогут вам в дальнейшей профессиональной деятельности в области информационной безопасности.
